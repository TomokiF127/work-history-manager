# 職務経歴管理ツール

PySide6とSQLAlchemyを使用した職務経歴管理デスクトップアプリケーション。プロジェクトと技術経験を管理し、重複なしで経験月数を集計します。

## 機能

### 主要機能
- **プロジェクト管理**: 案件情報（名称、期間、役割、業務内容、エンドユーザー、契約会社など）の登録・編集
- **技術管理**: OS、言語、FW/ライブラリ、ツール、クラウド、DBの使用技術を管理
- **経験月数集計**: 技術ごとの経験月数を重複なしで自動集計
- **マスタ管理**: 技術・役割・作業のマスタデータをCRUD操作で管理
- **自己PR管理**: 複数の自己PR項目を登録・編集、順序変更可能
- **エクスポート**: CSV/Markdown形式で統計データを出力
- **スキルシート生成**: Word文書(.docx)またはMarkdown形式でスキルシートを自動生成

### 特徴
- **重複なし集計**: 並行プロジェクトでの技術使用期間の重複を自動除外
- **技術使用期間の自動同期**: プロジェクトの技術選択と使用期間を自動同期
- **契約会社別集計**: スキルシート出力時に同一契約会社の参画期間を自動合算
- **工程順序管理**: 作業を上流工程から下流工程順に管理・出力
- **柔軟なフィルタリング**: 期間、技術、役割、フリーテキストでの検索
- **役割・作業の複数選択**: プロジェクトごとに複数の役割と作業を選択可能
- **順序管理**: 役割・作業の表示順序をドラッグ＆ドロップ不要の上下ボタンで簡単調整
- **検索機能**: 役割・作業選択時にリアルタイム検索でフィルタリング
- **キーボードショートカット**: Ctrl+S（保存）、Ctrl+N（新規）、Ctrl+D（複製）など効率的な操作
- **入力バリデーション**: プロジェクト名の必須チェック、日付整合性の確認

## システム要件

- Python 3.11以上
- macOS / Windows / Linux
- 画面解像度: 1400x900以上推奨

## 設定ファイル

### 初期設定

1. `config.ini.sample` を `config.ini` にコピー:
```bash
cp config.ini.sample config.ini
```

2. 必要に応じて `config.ini` を編集

### 設定項目

| セクション | キー | 説明 | デフォルト値 |
|-----------|------|------|------------|
| database | path | DBファイルの場所 | ./data/skills.db |
| database | echo | SQL文の表示 | false |
| app | name | アプリ名 | 職務経歴管理ツール |
| app | seed_initial_data | 初期データ投入 | true |
| export | csv_encoding | CSV文字コード | utf-8-sig |
| ui | window_width | ウィンドウ幅 | 1400 |
| ui | window_height | ウィンドウ高さ | 900 |

### 設定ファイルの優先順位

1. `./config.ini` （カレントディレクトリ）
2. `[プロジェクトルート]/config.ini`
3. `~/.workhistory/config.ini` （ユーザーホーム）

設定ファイルが無い場合はデフォルト値が使用されます。

## クイックスタート（最短2ステップ！）

### 📦 ステップ1: ダウンロード

1. GitHubリポジトリページの緑色の **「Code」** ボタンをクリック
2. **「Download ZIP」** を選択
3. ダウンロードしたZIPファイルを解凍
4. 解凍したフォルダを好きな場所に配置

### 🚀 ステップ2: 起動ファイルをダブルクリック

**macOS:**
- `起動.command` をダブルクリック
- 初回起動時に自動セットアップが開始されます
- セキュリティ警告が出た場合は下記の「macOSでのセキュリティ警告」を参照

**Windows:**
- `起動.bat` をダブルクリック
- 初回起動時に自動セットアップが開始されます

### 🎉 完了！

初回起動時は以下が自動で実行されます（ユーザーの確認を求めます）：
- ✅ Python仮想環境の作成
- ✅ 必要なパッケージのインストール
- ✅ 設定ファイルの作成

2回目以降は起動ファイルをダブルクリックするだけでアプリが起動します。

---

## 詳細なインストール方法

上記のクイックスタートで問題が発生した場合は、以下の手順をお試しください。

### 前提条件

- **Python 3.9以上**がインストールされている必要があります
  - macOS: `python3 --version` で確認
  - Windows: `python --version` で確認
  - インストールされていない場合: https://www.python.org/downloads/

### Git cloneでダウンロードする場合

```bash
cd ~/Develop
git clone https://github.com/TomokiF127/work-history-manager.git workhistory
cd workhistory
```

その後、`起動.command`（macOS）または`起動.bat`（Windows）をダブルクリックしてください。

### 手動セットアップ（起動スクリプトが使えない場合のみ）

**ステップ1: Python仮想環境の作成**
```bash
cd path/to/workhistory  # ダウンロードしたフォルダに移動
python3 -m venv venv    # macOS/Linux
python -m venv venv     # Windows
```

**ステップ2: 仮想環境の有効化**
```bash
source venv/bin/activate  # macOS/Linux
venv\Scripts\activate     # Windows
```

**ステップ3: 依存パッケージのインストール**
```bash
pip install -r requirements.txt
```

**ステップ4: 設定ファイルの作成**
```bash
cp config.ini.sample config.ini  # macOS/Linux
copy config.ini.sample config.ini  # Windows
```

**ステップ5: アプリケーションの起動**
```bash
python app/main.py
```

## 起動方法（2回目以降）

### 🖱️ ダブルクリック起動（推奨）

**macOS:**
- `起動.command` をダブルクリック

**Windows:**
- `起動.bat` をダブルクリック

### 📱 単一実行ファイル作成

**macOSアプリケーション(.app)を作成:**
```bash
./create_app_bundle.sh
```
→ `dist/職務経歴管理ツール.app` が作成されます

**単一実行ファイルを作成:**
```bash
./build_executable.sh
```
→ `dist/職務経歴管理ツール` が作成されます

### ⌨️ コマンドライン起動

**macOS:**
```bash
cd ~/Develop/workhistory
source venv/bin/activate
python app/main.py
```

**Windows:**
```bash
cd C:\Users\YourName\Develop\workhistory
venv\Scripts\activate
python app\main.py
```

初回起動時に`./data/skills.db`が自動作成され、初期マスタデータが投入されます。

## macOSでの初回起動時のセキュリティ警告について

GitHubからダウンロードしたファイルを初めて実行する際、macOSから「損害を与える可能性があります」という警告が表示される場合があります。これはAppleの開発者登録を行っていないためで、アプリケーション自体に問題があるわけではありません。

### 解除方法

**方法1: システム設定から許可する（推奨）**

1. `起動.command` をダブルクリック
2. 「"起動.command"は損害を与える可能性があるため開けません」という警告が表示される
3. **Appleメニュー () → 「システム設定」**を開く
4. サイドバーで**「プライバシーとセキュリティ」**をクリック
5. 下にスクロールして**「セキュリティ」**セクションを探す
6. 「"起動.command"は使用がブロックされました」という表示の横にある**「このまま開く」**ボタンをクリック
7. 確認ダイアログで**「開く」**をクリック

**方法2: 右クリックから開く**

1. `起動.command` を**右クリック（またはControlキー+クリック）**
2. **「開く」**を選択
3. 警告ダイアログで**「開く」**をクリック

**方法3: ターミナルから実行属性を付与**

```bash
cd ~/Develop/workhistory
chmod +x 起動.command
xattr -d com.apple.quarantine 起動.command
```

その後、ダブルクリックで起動できます。

### セキュリティについて

このアプリケーションはオープンソースであり、すべてのソースコードが公開されています。以下の点から安全性を確認できます:

- ソースコードは本リポジトリで完全に公開されています
- 外部への通信は一切行いません（すべてローカル処理）
- データはローカルのSQLiteデータベースにのみ保存されます
- マルウェアやスパイウェアは含まれていません

不安な場合は、ソースコードを確認した上でご利用ください。

## 使い方

### 1. プロジェクト管理
1. 「プロジェクト管理」タブを開く
2. 「新規」ボタン（またはCtrl+N）でプロジェクトを追加
3. プロジェクト情報を入力:
   - プロジェクト名、業務内容、詳細
   - 期間（開始日・終了日）
   - 「選択...」ボタンをクリックして役割・作業を複数選択
   - 使用技術を複数選択
4. 「技術使用期間をプロジェクト期間で自動生成」をクリック
5. 「保存」ボタン（またはCtrl+S）で保存

**役割・作業の選択:**
- 「選択...」ボタンをクリックしてモーダルダイアログを開く
- 検索ボックスで項目をフィルタリング可能
- 複数の項目を選択して「OK」をクリック
- 選択した項目がボタンテキストに表示される

**便利なショートカット:**
- `Ctrl+S`: プロジェクトを保存
- `Ctrl+N`: 新規プロジェクト作成
- `Ctrl+D`: 選択中のプロジェクトを複製
- `Ctrl+F`: 検索フィールドにフォーカス
- `Delete`: 選択中のプロジェクトを削除

### 2. 技術使用期間の編集
1. プロジェクトを選択
2. 「技術使用期間編集」ボタンをクリック
3. 各技術の使用期間を個別に調整可能
4. 「プロジェクト期間で自動生成」で一括生成も可能

### 3. 現場（Engagement）管理
1. プロジェクトの「現場」タブを開く
2. 「現場追加」で現場期間を追加
3. 各現場で役割や規模の上書き設定が可能
4. 「選択現場で技術期間を自動生成」で現場期間に基づく技術使用期間を生成

### 4. マスタ管理
1. 「マスタ管理」タブを開く
2. 各カテゴリ（OS、言語、フレームワークなど）のタブを選択
3. 追加・編集・削除でマスタデータを管理

**役割・作業の順序管理:**
- 役割タブまたは作業タブで項目を選択
- 「↑ 上へ」「↓ 下へ」ボタンで表示順序を調整
- 順序はスキルシート出力時の並び順に反映される
- 新規追加時は自動的に最後に追加される

### 5. 経験年数統計
1. 「経験年数統計」タブを開く
2. 期間フィルタで集計範囲を指定（任意）
3. 各技術カテゴリのタブで経験月数を確認
4. CSVまたはMarkdownでエクスポート

### 6. データエクスポート
- 個別カテゴリ: 各タブの「CSVエクスポート」「Markdownエクスポート」ボタン
- 全カテゴリ一括: 「全カテゴリ一括エクスポート」ボタン

### 7. 自己PR管理
1. 「自己PR管理」タブを開く
2. 「新規追加」ボタンで自己PR項目を追加
3. タイトルと内容を入力（ダブルクリックでも編集可能）
4. 「上に移動↑」「下に移動↓」ボタンで表示順序を調整
5. プレビューでスキルシート出力イメージを確認
6. 編集・削除も可能

### 8. スキルシート出力
1. メニューバーの「ファイル」→「スキルシートをエクスポート」を選択
2. 氏名を入力
3. 出力形式（Word文書またはMarkdown）を選択
4. 保存先を指定して実行
   - **契約会社別参画期間**: 同一契約会社での参画期間を自動合算
   - **プロジェクト詳細**: 業務内容、使用技術、役割などを整理して出力
   - **技術スキル一覧**: 経験期間と合わせて技術スキルを分類表示
   - **自己PR**: 登録した自己PR項目を順序通りに出力

## ディレクトリ構成
```
workhistory/
├── app/
│   ├── main.py              # エントリポイント
│   ├── models/              # データベースモデル
│   │   ├── base.py
│   │   ├── project.py
│   │   ├── master.py
│   │   ├── relations.py
│   │   ├── engagement.py
│   │   └── tech_usage.py
│   ├── services/            # ビジネスロジック
│   │   ├── db.py
│   │   ├── repository.py
│   │   ├── stats.py
│   │   ├── export.py
│   │   └── seed.py
│   ├── ui/                  # GUI
│   │   ├── main_window.py
│   │   ├── projects_view.py
│   │   ├── masters_view.py
│   │   └── stats_view.py
│   └── data/                # SQLiteデータベース（自動生成）
│       └── skills.db
├── requirements.txt
└── README.md
```

## データベース仕様

### SQLite設定
- WALモード有効
- 外部キー制約有効
- 同期モード: NORMAL

### 主要テーブル
- `projects`: プロジェクト情報
- `engagements`: 現場期間
- `tech_usages`: 技術使用期間明細
- `oses`, `languages`, `frameworks`, `tools`, `clouds`, `dbs`: 技術マスタ
- `roles`, `tasks`: 役割・作業マスタ（order_index列で順序管理）
- `project_roles`, `project_tasks`: プロジェクトと役割・作業の多対多関連
- `project_*`: プロジェクトと技術の多対多関連

## 集計ロジック

### 重複なし月数計算
1. 各技術の全使用期間を月単位（YYYY-MM）に展開
2. 重複する月を集合演算でユニーク化
3. ユニークな月数をカウント

例: プロジェクトA（2023-01〜2023-06）とプロジェクトB（2023-04〜2023-08）で同じ技術を使用
→ 実質経験月数: 8ヶ月（2023-01〜2023-08）

## 単一実行ファイル化（オプション）

PyInstallerを使用して単一実行ファイルを作成:

```bash
pip install pyinstaller
pyinstaller --onefile --windowed --name "WorkHistory" \
  --add-data "app/data:data" \
  --hidden-import="sqlalchemy.sql.default_comparator" \
  app/main.py
```

## よくある質問（FAQ）

### Q: 既にセットアップ済みの場合はどうなりますか？

A: **2回目以降はセットアップメッセージは表示されません。**

起動スクリプトは`venv`フォルダの有無で判断します：
- **初回起動時**（`venv`がない）: セットアップ確認メッセージが表示される
- **2回目以降**（`venv`がある）: 直接アプリが起動する

セットアップは初回のみ実行すれば、その後は不要です。

### Q: セットアップで「n」を選んだらどうなりますか？

A: セットアップがスキップされ、アプリは起動しません。

後でアプリを使いたい場合は、再度起動ファイルをダブルクリックして「y」を選択してください。

### Q: セットアップをやり直したい場合は？

A: `venv`フォルダを削除してから起動ファイルを実行してください。

```bash
# macOS/Linux
rm -rf venv
./起動.command

# Windows
rmdir /s venv
起動.bat
```

### Q: Python 3がインストールされていない場合は？

A: セットアップ時にエラーメッセージが表示され、インストール方法が案内されます。

https://www.python.org/downloads/ からPython 3.9以上をインストールしてください。

## トラブルシューティング

### Qt関連のエラー
```bash
export QT_QPA_PLATFORM=offscreen  # ヘッドレス環境の場合
```

### データベースエラー
- `./data/skills.db`を削除して再起動すると初期化されます

### 文字化け
- CSV出力はBOM付きUTF-8で保存されます
- Excelで開く際は「データ」→「テキストから」でインポート

### 依存パッケージのインストールエラー

ネットワーク環境やPythonのバージョンによってはインストールに失敗する場合があります。

**解決方法:**
```bash
# 仮想環境を有効化してから手動でインストール
source venv/bin/activate  # macOS/Linux
venv\Scripts\activate     # Windows

# 依存パッケージを再インストール
pip install --upgrade pip
pip install -r requirements.txt
```

## ライセンス

**このプロジェクトはライセンスフリーです。**

- 商用・非商用問わず自由にご利用いただけます
- 改変・再配布も自由に行えます
- クレジット表記は任意です（していただけると嬉しいです）

## 貢献について

### バグ報告・機能要望
- [Issues](https://github.com/TomokiF127/work-history-manager/issues)でご報告ください
- バグの場合は再現手順も含めてください

### 変更提案
- [Pull Request](https://github.com/TomokiF127/work-history-manager/pulls)でご提案ください
- 大きな変更の場合は事前にIssueで相談していただけると助かります

### 独自カスタマイズ
- **大幅なカスタマイズを行う場合はフォークを推奨します**
- フォーク後は自由に改変してお使いください
- 有用な機能は本リポジトリへのPRも歓迎です

## 作成者

TomokiF127

---

**License-Free Software** - Feel free to use, modify, and distribute.